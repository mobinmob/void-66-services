[main]
@type = classic
@version = @VERSION@
@description = "dockerd service"
@options = ( log env )
@user = ( root )
@maxdeath = 3

[start]
@execute = (
  if {
    foreground { execl-toc -X -m /sys/fs/cgroup/systemd -t cgroup -o none,name=systemd -d cgroup }
    foreground { execl-toc -X -S ${socket} -m 0660 -u root -g docker }
  }
  chpst -o 1048576 -p 1048576 dockerd -H unix://${socket}
)

[environment]
socket=!/run/docker.sock
